<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: background/browserHistory.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: background/browserHistory.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @module background script - browserHistory
 */
'use strict';

/**
 * Holds the number of visits from the most visited site.
 */
var maxVisits = 1;

/**
 * Gets the browser history to establish connections to sites which have already been visited.
 * 
 * @param {function} [callback] Optional callback function.
 */
function loadBrowserHistory(callback) {
	clearDatabase('visits', () => {
		saveVisitsFromBrowserHistory(callback);
	});
}

/**
 * Saves all visits in the defined interval in the database.
 * 
 * @param {function} [callback] Optional callback function.
 */
function saveVisitsFromBrowserHistory(callback) {
	var tmpQueue = [];
	chrome.history.search({
		'text': '', // All entries
		'startTime': startTime
	}, historyItems => {
		// Get the number of visits for each page during the specified time interval.
		asyncArrLoop(historyItems, (item, inCallback) => {
			// Ignore extension page
			if (item.url.includes(chrome.runtime.getURL(''))) {
				inCallback();
				return;
			}

			chrome.history.getVisits({
				url: item.url
			}, results => {
				// Update number of max. visits (because we want to visit all sites equally often)
				var count = results.filter(e => e.visitTime >= startTime).length;
				if (maxVisits &lt; count)
					maxVisits = count;

				tmpQueue.push([removeParamsFromUrl(item.url), count]); // Add to processing queue

				storeInDatabase('visits', getKeyFromUrl(item.url), count, false, () => {
					inCallback();
				});
			});
		}, () => {
			// Sort by visit count
			tmpQueue.sort((a, b) => a[1] - b[1]);

			// Insert urls into the real queue in sorted order
			for (const entry of tmpQueue) {
				if (entry[1] &lt; maxVisits)
					queue.push(entry[0]);
			}
			
			// Remove duplicates
			queue = queue.filter((item, pos, self) => self.indexOf(item) == pos);

			if (debug)
				console.log(`Initial queue = ${queue}`);

			typeof callback === 'function' &amp;&amp; callback();
		}, 0);
	});
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-background%2520script%2520-%2520browserHistory.html">background script - browserHistory</a></li><li><a href="module-background%2520script%2520-%2520browserWindow.html">background script - browserWindow</a></li><li><a href="module-background%2520script%2520-%2520connection.html">background script - connection</a></li><li><a href="module-background%2520script%2520-%2520database.html">background script - database</a></li><li><a href="module-background%2520script%2520-%2520message.html">background script - message</a></li><li><a href="module-background%2520script%2520-%2520searchTermGeneration.html">background script - searchTermGeneration</a></li><li><a href="module-background%2520script%2520-%2520searchTermSetup.html">background script - searchTermSetup</a></li><li><a href="module-background%2520script%2520-%2520settings.html">background script - settings</a></li><li><a href="module-background%2520script%2520-%2520setup.html">background script - setup</a></li><li><a href="module-background%2520script%2520-%2520thirdParty.html">background script - thirdParty</a></li><li><a href="module-background%2520script%2520-%2520util.html">background script - util</a></li><li><a href="module-background%2520script%2520-%2520windowState.html">background script - windowState</a></li><li><a href="module-content%2520script%2520-%2520search.html">content script - search</a></li><li><a href="module-content%2520script%2520-%2520setup.html">content script - setup</a></li><li><a href="module-content%2520script%2520-%2520tab.html">content script - tab</a></li><li><a href="module-content%2520script%2520-%2520util.html">content script - util</a></li><li><a href="module-html%2520script%2520-%2520extensionPage.html">html script - extensionPage</a></li><li><a href="module-html%2520script%2520-%2520workingPage.html">html script - workingPage</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.5</a> on Wed Sep 16 2020 06:29:08 GMT+0000 (Greenwich Mean Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
