<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: background/connection.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: background/connection.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @module background script - connection
 */
'use strict';

/**
 * Keeps track of the websites we want to visit next.
 */
var queue = [];

/**
 * Starts the application: Creates fake connections in the hidden window and removes the tabs
 * when finished. The selected algorithm defines what exactly these fake connections do.
 */
function runApplication() {
	// 1. Load browser history; 2. Load search terms; 3. Start connection loop
	loadBrowserHistory(() => {
		loadSearchTerms(startConnectLoop);
	});
}

/**
 * Repeats connecting to webpages.
 */
function startConnectLoop() {
	setTimeout(() => {
		// Continue while limit not reached and queue not empty.
		if ((todayCount &lt; connectionLimit) &amp;&amp; queue.length > 0) {
			connectToUrl(queue.shift());
			startConnectLoop();
		}
	}, Math.floor(10000 * Math.random() + 10000)); // 10-20 seconds
}

/**
 * Creates a fake connection to a given url.
 * We open the given url in a new tab in our hidden browser window.
 * 
 * @param {string} url The url we want to connect to.
 */
function connectToUrl(url) {
	getFromDatabase('visits', getKeyFromUrl(url), result => {
		// Do not visit a page too many times and do not visit the extension page
		// (does not start with http)
		if (result == undefined || !url.startsWith('http') || result.value[0] >= maxVisits) {
			return;
		}

		// If the tab limit is reached, wait until we can open a new tab again
		var waiting = setInterval(() => {
			if (tabLimit > currentTabs.reduce((n, val) => n + (val.id != -1), 0)) {
				// If we can open a new tab, stop waiting and do not repeat anything
				clearInterval(waiting);

				// Visit urls from the history again until we visited all of them equally often.
				storeInDatabase('visits', getKeyFromUrl(url), result.value[0] + 1, false);

				if (result.value[0] + 1 &lt; maxVisits)
					queue.push(url);

				chrome.tabs.create({
					windowId: windowId,
					index: currentTabs.length,
					url: url,
					active: false
				}, tab => {
					todayCount++;
					tab.isNew = true; // We need this to execute content scripts only once
					tab.type = 'execAlgo';
					currentTabs[currentTabs.findIndex(elem => elem.id == -1)] = tab;
				});
			}
		}, 3000); // Check all 3 seconds if a new tab can be opened
	});
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-background%2520script%2520-%2520browserHistory.html">background script - browserHistory</a></li><li><a href="module-background%2520script%2520-%2520browserWindow.html">background script - browserWindow</a></li><li><a href="module-background%2520script%2520-%2520connection.html">background script - connection</a></li><li><a href="module-background%2520script%2520-%2520database.html">background script - database</a></li><li><a href="module-background%2520script%2520-%2520message.html">background script - message</a></li><li><a href="module-background%2520script%2520-%2520searchTermGeneration.html">background script - searchTermGeneration</a></li><li><a href="module-background%2520script%2520-%2520searchTermSetup.html">background script - searchTermSetup</a></li><li><a href="module-background%2520script%2520-%2520settings.html">background script - settings</a></li><li><a href="module-background%2520script%2520-%2520setup.html">background script - setup</a></li><li><a href="module-background%2520script%2520-%2520thirdParty.html">background script - thirdParty</a></li><li><a href="module-background%2520script%2520-%2520util.html">background script - util</a></li><li><a href="module-background%2520script%2520-%2520windowState.html">background script - windowState</a></li><li><a href="module-content%2520script%2520-%2520search.html">content script - search</a></li><li><a href="module-content%2520script%2520-%2520setup.html">content script - setup</a></li><li><a href="module-content%2520script%2520-%2520tab.html">content script - tab</a></li><li><a href="module-content%2520script%2520-%2520util.html">content script - util</a></li><li><a href="module-html%2520script%2520-%2520extensionPage.html">html script - extensionPage</a></li><li><a href="module-html%2520script%2520-%2520workingPage.html">html script - workingPage</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.5</a> on Wed Sep 16 2020 06:29:09 GMT+0000 (Greenwich Mean Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
